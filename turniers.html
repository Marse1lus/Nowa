{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤</title>
    <link rel="stylesheet" href="{% static 'tournaments/styles.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—Ö–æ–¥–∞ -->
    <div id="loginModal" class="modal" aria-hidden="true">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–í—Ö–æ–¥</h2>
            <form id="loginForm">
                <input type="email" placeholder="Email" required>
                <input type="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                <button type="submit">–í–æ–π—Ç–∏</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="registerModal" class="modal" aria-hidden="true">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <form id="registerForm">
                <input type="text" placeholder="–ò–º—è" required>
                <input type="email" placeholder="Email" required>
                <input type="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                <input type="password" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </form>
        </div>
    </div>

    <header class="header" role="banner">
        <div class="logo" role="heading" aria-level="1">
            <a href="{% url 'home' %}" class="logo-link">
                NO<span class="highlight-w">W</span>ACHAMPIONSHIP ü§º‚Äç‚ôÇÔ∏è
            </a>
        </div>
        <nav class="nav-menu" role="navigation" aria-label="–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é">
            <a href="{% url 'tournament_list' %}" role="menuitem">–¢—É—Ä–Ω–∏—Ä—ã</a>
            
            <div class="dropdown">
                <a href="#" 
                   class="nav-link" 
                   role="button" 
                   aria-haspopup="true" 
                   aria-expanded="false"
                   aria-controls="sections-menu">
                    –°–µ–∫—Ü–∏–∏ ‚ñº
                </a>
                <div class="dropdown-content" 
                     id="sections-menu" 
                     role="menu" 
                     aria-label="–í—ã–±–æ—Ä —Å–µ–∫—Ü–∏–∏">
                    <a href="#" role="menuitem">–ú–∞–º–µ—Ç–æ–≤–∞</a>
                    <a href="#" role="menuitem">–ñ–∞–Ω—Å—É–≥—É—Ä–æ–≤–∞</a>
                </div>
            </div>
            
            <div class="dropdown">
                <a href="#" 
                   class="nav-link" 
                   role="button" 
                   aria-haspopup="true" 
                   aria-expanded="false"
                   aria-controls="about-menu">
                    –û –Ω–∞—Å ‚ñº
                </a>
                <div class="dropdown-content" 
                     id="about-menu" 
                     role="menu" 
                     aria-label="–û –Ω–∞—Å">
                    <a href="https://teamnova.kz/p/d9b54a/" role="menuitem"> –û–¥–µ–∂–¥–∞</a>        
                    <a href="#" role="menuitem">–ì–∞–ª–µ—Ä–µ—è</a>
                    <a href="https://teamnova.kz/?fbclid=PAZXh0bgNhZW0CMTEAAabqvuAdlphCRMiUAHZdep2UTLlLhtCTS6DYdvksrVo9BqU0Xt3qHUsoojE_aem_M8j27ck8Z9D-t-2EcmU9aQ#contacts" role="menuitem" target="_blank">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
                </div>
            </div>

            <a href="#" class="signup">–í–æ–π—Ç–∏</a>
            <a href="#" class="signup">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</a>
        </nav>
    </header>

    <main>
        <h2>–°–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤</h2>
        <div class="filters">
            <button class="filter-btn">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ —Ç—É—Ä–Ω–∏—Ä—ã</button>
            <button class="filter-btn">–¢–µ–∫—É—â–∏–µ —Ç—É—Ä–Ω–∏—Ä—ã</button>
            <button class="filter-btn">–í–∞—à–∏ —Ç—É—Ä–Ω–∏—Ä—ã</button>
        </div>

        <div class="button-container">
            <button class="nav-btn" onclick="window.location.href='{% url 'create' %}'">–°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä</button>
            <button class="nav-btn" onclick="window.location.href='/nearest-section'">–ë–ª–∏–∂–∞–π—à–∞—è —Å–µ–∫—Ü–∏—è</button>
            <button class="nav-btn" onclick="window.location.href='/map'">–ö–∞—Ä—Ç–∞</button>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" placeholder="–ù–∞–π—Ç–∏ —Ç—É—Ä–Ω–∏—Ä">
            <select class="search-input">
                <option value="">–¢–∏–ø —Ç—É—Ä–Ω–∏—Ä–∞</option>
                <option value="greco">–ì—Ä–µ–∫–æ-—Ä–∏–º—Å–∫–∞—è –±–æ—Ä—å–±–∞</option>
                <option value="freestyle">–í–æ–ª—å–Ω–∞—è –±–æ—Ä—å–±–∞</option>
                <option value="judo">–î–∑—é–¥–æ</option>
                <option value="bjj">BJJ</option>
            </select>
        </div>

        <div class="date-container">
            <input type="date" class="date-input" placeholder="–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞">
            <input type="date" class="date-input" placeholder="–ö–æ–Ω–µ—Ü –¥–∞—Ç—ã">
            <button class="search-btn">–ü–æ–∏—Å–∫</button>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —Ç—É—Ä–Ω–∏—Ä–æ–≤ –≤ –≤–∏–¥–µ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
        <div class="tournaments-grid">
            {% for tournament in tournaments %}
                <div class="tournament-card">
                    {% if tournament.image %}
                        <img src="{{ tournament.image.url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞">
                    {% else %}
                        <img src="{% static 'tournaments/images/default.jpg' %}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞">
                    {% endif %}
                    <div class="tournament-info">
                        <h2>{{ tournament.name }}</h2>
                        <p>–ú–µ—Å—Ç–æ: {{ tournament.location }}</p>
                        <p>–ù–∞—á–∞–ª–æ: {{ tournament.start_date|date:"d.m.Y H:i" }}</p>
                        <p>–û–∫–æ–Ω—á–∞–Ω–∏–µ: {{ tournament.end_date|date:"d.m.Y H:i" }}</p>
                        <p>–î–µ–¥–ª–∞–π–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {{ tournament.registration_deadline|date:"d.m.Y H:i" }}</p>
                    </div>
                </div>
            {% empty %}
                <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤</p>
            {% endfor %}
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const loginBtn = document.querySelectorAll('.signup')[0];
                const registerBtn = document.querySelectorAll('.signup')[1];
                const loginModal = document.getElementById('loginModal');
                const registerModal = document.getElementById('registerModal');
                const closeButtons = document.getElementsByClassName('close');
                const filterButtons = document.querySelectorAll('.filter-btn');
                const searchInput = document.querySelector('.search-input[type="text"]');
                const typeSelect = document.querySelector('.search-input[type="select"]');
                const dateInputs = document.querySelectorAll('.date-input');
                const searchButton = document.querySelector('.search-btn');

                function openModal(modal) {
                    modal.style.display = "block";
                    modal.style.opacity = "1";
                    modal.setAttribute('aria-hidden', 'false');
                }

                function closeModal(modal) {
                    modal.style.opacity = "0";
                    setTimeout(() => {
                        modal.style.display = "none";
                        modal.setAttribute('aria-hidden', 'true');
                    }, 300);
                }

                loginBtn.onclick = function(e) {
                    e.preventDefault();
                    openModal(loginModal);
                }

                registerBtn.onclick = function(e) {
                    e.preventDefault();
                    openModal(registerModal);
                }

                Array.from(closeButtons).forEach(button => {
                    button.onclick = function() {
                        closeModal(loginModal);
                        closeModal(registerModal);
                    }
                });

                window.onclick = function(event) {
                    if (event.target == loginModal || event.target == registerModal) {
                        closeModal(loginModal);
                        closeModal(registerModal);
                    }
                }

                filterButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const status = this.textContent.trim();
                        fetchTournaments({ status });
                    });
                });

                searchButton.addEventListener('click', function() {
                    const query = searchInput.value;
                    const type = typeSelect.value;
                    const startDate = dateInputs[0].value;
                    const endDate = dateInputs[1].value;
                    fetchTournaments({ query, type, startDate, endDate });
                });

                function fetchTournaments(params = {}) {
                    const queryString = new URLSearchParams(params).toString();
                    fetch(`/tournaments?${queryString}`)
                        .then(response => response.json())
                        .then(data => {
                            updateTournamentList(data.tournaments);
                        })
                        .catch(error => {
                            console.error('There was a problem with the fetch operation:', error);
                        });
                }

                function updateTournamentList(tournaments) {
                    const grid = document.querySelector('.tournaments-grid');
                    grid.innerHTML = ''; // –û—á–∏—Å—Ç–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫
                    tournaments.forEach(tournament => {
                        const card = document.createElement('div');
                        card.className = 'tournament-card';
                        card.innerHTML = `
                            <img src="${tournament.image || '/static/tournaments/images/default.jpg'}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞">
                            <div class="tournament-info">
                                <h2>${tournament.name}</h2>
                                <p>–ú–µ—Å—Ç–æ: ${tournament.location}</p>
                                <p>–ù–∞—á–∞–ª–æ: ${new Date(tournament.start_date).toLocaleString()}</p>
                                <p>–û–∫–æ–Ω—á–∞–Ω–∏–µ: ${new Date(tournament.end_date).toLocaleString()}</p>
                                <p>–î–µ–¥–ª–∞–π–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${new Date(tournament.registration_deadline).toLocaleString()}</p>
                            </div>
                        `;
                        grid.appendChild(card);
                    });
                }
            });
        </script>
    </main>
</body>
</html> 
